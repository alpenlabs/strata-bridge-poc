#![allow(unused)]
use bitcoin::{hashes::Hash, psbt::raw, Block, Txid};
use strata_proofimpl_btc_blockspace::block::{check_merkle_root, check_witness_commitment};

// Ts is commited in the Claim Transaction
// and bridge_out_txid TxId = [u8; 32];
pub fn get_claim_txn(block: &Block, claim_txn_idx: u32) -> (u32, Txid) {
    assert!(check_merkle_root(block));
    assert!(check_witness_commitment(block));

    let claim_txn = block
        .txdata
        .get(claim_txn_idx as usize)
        .expect("Claim txn not found for the claim_txn_idx");
    let mut witness = claim_txn.input[0].witness.to_vec();

    // Remove last two witness elements
    witness.pop().unwrap();
    witness.pop().unwrap();

    let (ts, raw_tx_id) = parse_claim_witness(witness);

    (
        ts,
        Txid::from_slice(&raw_tx_id).expect("Failed to create Txid from bytes"),
    )
}

fn parse_wots32_sig(digits: [u8; 8]) -> u32 {
    u32::from_le_bytes(std::array::from_fn(|i| {
        (digits[2 * i + 1] << 4) + digits[2 * i]
    }))
}

fn parse_wots256_sig(digits: [u8; 64]) -> [u8; 32] {
    std::array::from_fn(|i| (digits[2 * i + 1] << 4) + digits[2 * i])
}

fn parse_claim_witness(data: Vec<Vec<u8>>) -> (u32, [u8; 32]) {
    let mut digits = data
        .chunks_exact(2)
        .map(|chunk| {
            assert!(chunk[0].len() == 20);
            if chunk[1].is_empty() {
                0
            } else {
                chunk[1][0]
            }
        })
        .collect::<Vec<_>>();
    digits.reverse();
    let (superblock_period_start_ts_digits, bridge_out_txid_digits) = digits.split_at(10);

    let bridge_out_txid = parse_wots256_sig(bridge_out_txid_digits[3..].try_into().unwrap());
    let superblock_period_start_ts =
        parse_wots32_sig(superblock_period_start_ts_digits[2..].try_into().unwrap());
    (superblock_period_start_ts, bridge_out_txid)
}

#[cfg(test)]
mod test {
    use bitcoin::{Block, Transaction};
    use prover_test_utils::get_bitcoin_client;
    use strata_btcio::rpc::traits::Reader;

    use super::{get_claim_txn, parse_claim_witness};

    #[tokio::test]
    async fn test_get_claim_txn() {
        let btc_client = get_bitcoin_client();
        let claim_tx_block_num = 1044;
        let claim_tx_block = btc_client.get_block_at(claim_tx_block_num).await.unwrap();

        let raw_block = hex::encode(bitcoin::consensus::serialize(&claim_tx_block));
        dbg!(raw_block);

        let claim_tx_idx = 2;

        let claim_tx_result = get_claim_txn(&claim_tx_block, claim_tx_idx);
        dbg!(claim_tx_result);
    }

    #[test]
    fn test_claim_tx_static() {
        let raw_block = "00000020199d72ea091f44ec7286496f0abb81077a0336de0211ca737ab8c1e80ca49917131004809b16f07085f1de56d589971ba7e9b19668e247ac8aab670edb10a10a91362d67ffff7f200000000004020000000001010000000000000000000000000000000000000000000000000000000000000000ffffffff0402140400ffffffff026052a8040000000016001406d6ede725893732fb24c3468ff3225b831686280000000000000000266a24aa21a9ed63cec465e04395952b19d5e7ee475e5de024db4c9f645710a16593b7603f62e6012000000000000000000000000000000000000000000000000000000000000000000000000002000000000101f831f68d0067e6de9056fe0c7b511974ab5f5126d8d0579ad4a40407bdce67c10000000000fdffffff020065cd1d0000000022512089a7d042371d88422ceb54561113151271292a868275768358e6d631c0a6a251b84573070000000016001481792d442db2a9ad84c74a26f7918a4e308a06f4024730440220747580d2f36bcb6b56783a6e3e566e7aa96a0e8c1f7a4e01c837c9615e1267cc022012bcc1faf75576d4bca16d0f843fd9309b1c5f1d216fc39c326b933bfb60b592012103b299d12b9a8ea09e377e477c4cebc56a4b8f23dea6d9de6897cf6f95997bd36700000000020000000001019266bda7bc96cea48d183dac4b7435c93a8ddbcaaf5606665793923639b1ecd70000000000fdffffff022e50cd1d000000002251203018dea7fc62d38c3d3afc051a09f05e29f54d52d44e9d17c2e7c1deee7a1a234a01000000000000225120a7aaff785702a464a0444e51b7ae3354999e1047c42c6df6e778e2928d155d7b9c140190c293401607c7abd285e565519460b9aa0f520014a6d918a8192ddad74485e198070dfb959ecf897301091428be1b30f99375046c7fff988ab65420a6832dec01031494ed1b9baaeeafb87ece23df80038ae2e10cdc97010f14738c4aeeb8e12502e3b9a2ca830bb95985c0a148010d14efc2b2fcdf5cabe1560b14989e37d469ba8d2b50010714612cda27bbd811684de1788d1d9a420e9cc27a82010b14fd65e0582755ec03e42b97c5b3158455cacc5e6201061401e5bbcd104f1936613bbba1c8d1935f406010a3010d149740d674d1f93aa05fadffd82fb6c8da1b32f059010814abfc8c527dcbca6ff2f91a35744e25705f3ac7f60014ca9c61114816a5c1812d07a2fb98e209c5b94853010114aab6b68a2a98ae2ea1215891c07575c309de05dd0101142db06d809617c2c356d695809efcd2330105fce201091429609ed3e469ac98f977298cfd5021e61617977f010714c7967496cefd40e76a4a30e3eb6e11e8d9d6c30e0014c433d8f172ef70e972d263a689864b224de11005010a149388050bc91744c48f8bfa2e2b07264277a10ad901031475e0da964c1f07832acbdc6692837107cb7890fd010714e43981a0b4f765dccfd3c7567092fc1cacc27871010e140fed5286152be800f943a3d9b9b36e8fc3bc2f8f010b14ff5e0f9a35791ce0c826ae7294cab87d124f62e3010c143776eb4bd1d4ae34aa0bad57dd337a6405e48822010114b63e650abab8b6315449f9b0d45f3a323b60de630108145a1b5cc9cba790e32cdfdbce6b1505b02b01e25101061473bcaa481c98e932a84ce0b62ee195278ee9d043010614724b54a2a94fd901e0de81c13ee45801abf36511010b14c2862ef1117d6df35685279b9f031b8e985cd47901081471bb41e5c82df66f63916f99a282e8375c184e85010b14fd90915c3ac9dc5d7b671be38505b8c807d56f75010d1481e06aa08704bc512d8717064dadf60fe9464ee600149dac8e1a366c2936fedd77c7c3e5074dedfecf45010b148086544ab7ab9c23b62c5d05d278083dc2eee3a9010f141f41c97b827a45ac1c8ca9c1ac130efdb57513020108140ba501a1cb7650a5f142a5e1f6b48029d8595706010d149a555a0fbd1e1727f767952be6b2abca6c50115f010214b29d597f01751ecc5afa7d16a8cb0a8f8727d6ee010d14886f32d8a0cd91c28a35463090c79e70cf8c650b0014e9ad75f35c43e12699726706c6b6f09734fbd3b501081422cc4b22ae998b2e22d3e07c0fa4dd7bf61810e1010d147a4a6bb9a9b96eea6f6c09958bedbb34ce7414e2010b143eac537d1e0b5b48c97d4f20ddb85939b6ac840a010d143b601c122713751951232be56ea3a67b9922a39a0103141559a393b34ccfaaf3e5278010b3b7b22f5f97d1010614a8852918dd2f198c0a6058808b8c24a8d23ab1e6010b148c63a70e5dc25b8500a7256d98654b66f451aef401061494fe708a6497476b72a3c55c004c000388dec37a010114f0cbd2b7387b0fddb318202a2c628ccf3a5866700109146fa8950a0edb25ce98cc9cfc31abc32e8143a87c010e14f8836f376a3e7cafe10c15a18ebf5c4aff5a6e7b010714598bff0f93341d3f12756e3e8507cc41e74bd38c010714b8c494fd875a95c00d139b08238fd64fa685d8e5010a1497f119df32da966a2d10129722bb2b08e937ec52010e149c0d55e83f1797950eedc33d554dce23344ab5a001081448e31ec37f2ca4292e42dd0aaf0ac31251471b170104148761d4cac65268ce4a4e6ae525c0064b7f307b4801031480777f57a9381c7efc366872aeb9d7337cf0ae82010114dfe66ff0a42ea45ead708b62be5380421010af82010c14b589a7c7c858165bf5be6589da033cdaf40867fb010414a7b9787079c534818517b30a0b9876fd338a39a9010814e8f839236da2bbde9fbf8a5c4d6f8b8700cde6b5010b14e9596c60538548f124a98489cede7552806667ac010f145fa9b905e895d2ef4bf7530e114e8db6bc77b7c6010414fbda2f6109896cdf661a09c0425c72b9a74de467010e14a6f77b5693ca187b54a580e78ae00a7b9c6bf917010114cb096ba10690a6c612904e9be9fd5fae7db1e536010c14def61f342e830008e5cf47cb9e191d6cb2b76224010914e7eb59d652516009c287d4daf12a540f2b9916aa0106142d92774a63b543617ff0db516cca51d522fd7c2801071420720ca49532b2299fdee67b82e3c17af8fbe243010214456277e8cbcb1b91b5436fc9286f9148e918987a010d14e9eb57f8727a6580fafe4cf5060eec517ddd8594010314612866ca8152440afddc35bb93cd14a14652e9d0010614d21d9fc3fb4cda2d51eacd0ee40e5ffe15d9ee55010914199ea52c8357f2d34059cce6e6a1a7db686002520014a66b7963d0c2686cb8d7c8922a226f7622832f7e010414a3eecb930ffe0ab617449b932dacc9521f09730d010afd4d155fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914a60ab568a4139fdfa12925107655218b67d8349a886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914fdf4310c23862b4d7040239d7acd819f5d5358d8886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79149307217a5070bf2d29fea1cdbe8720537301966b886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79141ac3b41961ac53327b5da05db1a7b93e2151255e886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79140cc118252321429e065e62c5fe9dc53f36f963f4886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914afbf5b2f48975221a20c2697194be4048e68268e886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79145abf490129ae3dd8a61c6f5414b5d63c49700301886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79148e379dfef16a2131c5874acac6fb2c02e7f4c54c886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914f4476db874e210e9a28fbc6e61a066e0ebd10580886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914261fbbb1c199841d43d94346a79578b4cd60948b886d6d6d6d6d6d6d6d6c768f6c7d946c7d946c7d946c7d946c7d946c7d946c7d940178936c76937693769376936c93886d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79147eb35877d2dcc22d844a6426952e23870e1f1692886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791480bb0e9e84060baccc1e403149ec38f082583698886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79143167523687f6d65aa7ac40d5a87287fddbfee073886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914642704e1ea59f544b28c8c3b8fe535b09f260169886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79143b10e77e26f17019e38d1db70b9a3ece322e6030886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914e9596c60538548f124a98489cede7552806667ac886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914cd3870ca469f42e1d9b4b66d624038cad62d3e2c886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914afd72e092e59679a7bd77412bb177ded76d6f5fd886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79145a3fda8362a69aa87851d001cfacffc0cb259bb9886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791437947ba21d964946f44fb93ad90a75dd60c9208f886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791480e02093a3b7c66e8814eda2ac2688a91a7df653886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791420bd264f2bf9735e44f0e434b481fa6205877845886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914373dec50f0b9d9fcc6347aa692bfb3c169f9a106886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791401bded839b07015d064f18d4b1233bb68dc75066886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791491d324d0ef7e1e44bf37eb69ae811cd204af07a5886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914804db0c593bbe21d175997c12b430dea5fdaf5ef886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914d32177c17b4824308caa9273111e8bc2eedf3dcc886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914524e9199175bd3e2b41a817a0f954166e3184057886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914e2aefc27344e7f86206e6d743cb2259879778743886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914ed56aadfdfa8574ad4f3dfeb4c7356efc03a0d5a886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914a860031c16654fe4246e97c9668a308d9ad384f5886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79148c66c104638b1f03d4064fed1922e90ffc988f96886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914d75113e9f6b155c8e03e295714c8563272adb7a5886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791471d7299596281e482359fe54e557e7afbf0cc72c886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914ad33fc91ecd665474fb62eacb3043160728addfc886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914dc427189fc43ab8f68dc6550cd409a8435015d96886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914669974f716290360cd74038cbd6f91f0a5977f35886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914108db6c268f93a822ccdc21df85e56a7ccf3311f886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914ecf5362ca72da42dff94d5f089d29d0e21e77a7b886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914920cdf47c64a2e02900e1445997cd145b06d7476886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79147e0beed465bd6439937b6ce2a7e538e5bebfb808886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79146d95b41bf9ffde47e29f1b2f075bbc36784ca904886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791435f39e3bd84ba2f72da240c47a99d731a4d98e49886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914e7d4d105a998025ecd7ce879a01096eaf08788e0886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79148086544ab7ab9c23b62c5d05d278083dc2eee3a9886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791414745914dd1e27c9d5880b2650fd335c43a012ad886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914b854bd58749dbfdc5a7a946422c8d8d38c6da2bb886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791496767d7f2a46782bcc33e8a67b69b760f458e753886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791434d3e425b27eba82ffb3a8586e52bccaefac052f886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791426eb18968ab6c5528d193035bf3c9e701ddc1df6886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791442158a99df1b7de50663ee323f5230d1e09b3d28886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79149e4268dae1974eb4b9692ae845b587773389a0c9886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79148cfc4a3a86a478313aa393bede2da011383751d3886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791412d302f706cfcca72de7890048b729fa76c809e8886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791490afe51362c6453e2b02923431dcc10be996ce20886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914512df486b9bce7b37e6558810733492d28ded05c886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914ba48ef5f17acd51c9fabfce97104272f75b60920886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79144574f22897336dd371d439aedaaa21659b26c329886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914dbbacb572f0cf06979337ec67a5c1f0fa669b67e886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914d6dede42dce15c038ebd2333595300befd24b3df886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914142d7535c8a8d5e3daba33b709ba0aee470a624b886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79142c488b01d6c29c9d505ea9e911d852799763d347886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79144b4ae8c33e7bebfc4444c1876ce4ddba39c5a571886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79145432efcdf237c67a82b3471e1c8d05ad884badd6886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79141847bf31c0106b95fca844e71a1d127bbd547b3a886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79144d80ee741232108315adc32cce13579ba4d5823b886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791412dc8d66655423d28cbd9ce0b06c82967bc86183886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791432de3fb1cf461e89a97c34c4cd416dfe2660d02b886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79146415e57e8525ef9b26728d84af7c56a62066471d886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79141aadd8d939a02a0d7dd6d8d4fad316478a1750ad886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914b1599f4fde540110f50ec4fa864a7b64e602b619886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914f09e4798f0774b85afb5f56cd4f1c4fd5f05893d886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c79142ac1a87f8f8847a200726dc9c5e2ce428259a40c886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c791494ed1b9baaeeafb87ece23df80038ae2e10cdc97886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914696eb4a0b5bbfc59f5caf296acdcd1b3c4542e6b886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914dde1e293f276be281eed76c4fda165706ae549aa886d6d6d6d6d6d6d6d5fa3766b6b76a976a976a976a976a976a976a976a976a976a976a976a976a976a976a96c7914806ad38a6ebef6167d1e0d1abe0b415fd3fd6baa886d6d6d6d6d6d6d6d6c768f6c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d946c7d9402c003936c76937693769376936c9376937693769376936c93886d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d6d5121c12be4d02127fedf4c956f8e6d8248420b9af78746232315f72894f0b263c80e810000000002000000000101b507cc00b0be5f8b63ea2ec84e57f1b1a5bedcad9ee68e6793ad5671714cc6b70000000000fdffffff3c98f0cc1d00000000225120a7aaff785702a464a0444e51b7ae3354999e1047c42c6df6e778e2928d155d7b4a01000000000000225120acb9c6e99223b203a4af8b2a6ce39bb1e23c0a3123f5242f0e0b1777a53a36774a01000000000000225120ebdc247bd6c6454be70ebb16f54203e50549c5c9053350a0295696a517ceaad24a010000000000002251205b99180e687628d855fbf65bc9a78bea6ef1870465b8efdfd756fbdb9f0f34904a0100000000000022512035aeb2f8fdb9617f2b1c04c78d452f6fbf245cd77bea1a65cdd3b494d5cb594e4a010000000000002251204288d1d887e0fc2511fb6131269c0f607f3440a696eff4fbb47c04215f10e5d14a010000000000002251203409a0a1b4dac615bbb610e5f129a1a0529f577557033dad24e22900b6409baa4a01000000000000225120dad7948aeda4c13ff9ef090f9b4948b972b4a559602e1e4b7aa8d53a564d87c84a010000000000002251202874162b92b8d3be94843507d3a2c27b533e61ae775a177e7317e935be89f04f4a01000000000000225120acb9c6e99223b203a4af8b2a6ce39bb1e23c0a3123f5242f0e0b1777a53a36774a01000000000000225120ebdc247bd6c6454be70ebb16f54203e50549c5c9053350a0295696a517ceaad24a010000000000002251205b99180e687628d855fbf65bc9a78bea6ef1870465b8efdfd756fbdb9f0f34904a0100000000000022512035aeb2f8fdb9617f2b1c04c78d452f6fbf245cd77bea1a65cdd3b494d5cb594e4a010000000000002251204288d1d887e0fc2511fb6131269c0f607f3440a696eff4fbb47c04215f10e5d14a010000000000002251203409a0a1b4dac615bbb610e5f129a1a0529f577557033dad24e22900b6409baa4a01000000000000225120dad7948aeda4c13ff9ef090f9b4948b972b4a559602e1e4b7aa8d53a564d87c84a010000000000002251202874162b92b8d3be94843507d3a2c27b533e61ae775a177e7317e935be89f04f4a01000000000000225120acb9c6e99223b203a4af8b2a6ce39bb1e23c0a3123f5242f0e0b1777a53a36774a01000000000000225120ebdc247bd6c6454be70ebb16f54203e50549c5c9053350a0295696a517ceaad24a010000000000002251205b99180e687628d855fbf65bc9a78bea6ef1870465b8efdfd756fbdb9f0f34904a0100000000000022512035aeb2f8fdb9617f2b1c04c78d452f6fbf245cd77bea1a65cdd3b494d5cb594e4a010000000000002251204288d1d887e0fc2511fb6131269c0f607f3440a696eff4fbb47c04215f10e5d14a010000000000002251203409a0a1b4dac615bbb610e5f129a1a0529f577557033dad24e22900b6409baa4a01000000000000225120dad7948aeda4c13ff9ef090f9b4948b972b4a559602e1e4b7aa8d53a564d87c84a010000000000002251202874162b92b8d3be94843507d3a2c27b533e61ae775a177e7317e935be89f04f4a01000000000000225120acb9c6e99223b203a4af8b2a6ce39bb1e23c0a3123f5242f0e0b1777a53a36774a01000000000000225120ebdc247bd6c6454be70ebb16f54203e50549c5c9053350a0295696a517ceaad24a010000000000002251205b99180e687628d855fbf65bc9a78bea6ef1870465b8efdfd756fbdb9f0f34904a0100000000000022512035aeb2f8fdb9617f2b1c04c78d452f6fbf245cd77bea1a65cdd3b494d5cb594e4a010000000000002251204288d1d887e0fc2511fb6131269c0f607f3440a696eff4fbb47c04215f10e5d14a010000000000002251203409a0a1b4dac615bbb610e5f129a1a0529f577557033dad24e22900b6409baa4a01000000000000225120dad7948aeda4c13ff9ef090f9b4948b972b4a559602e1e4b7aa8d53a564d87c84a010000000000002251202874162b92b8d3be94843507d3a2c27b533e61ae775a177e7317e935be89f04f4a01000000000000225120acb9c6e99223b203a4af8b2a6ce39bb1e23c0a3123f5242f0e0b1777a53a36774a01000000000000225120ebdc247bd6c6454be70ebb16f54203e50549c5c9053350a0295696a517ceaad24a010000000000002251205b99180e687628d855fbf65bc9a78bea6ef1870465b8efdfd756fbdb9f0f34904a0100000000000022512035aeb2f8fdb9617f2b1c04c78d452f6fbf245cd77bea1a65cdd3b494d5cb594e4a010000000000002251204288d1d887e0fc2511fb6131269c0f607f3440a696eff4fbb47c04215f10e5d14a010000000000002251203409a0a1b4dac615bbb610e5f129a1a0529f577557033dad24e22900b6409baa4a01000000000000225120dad7948aeda4c13ff9ef090f9b4948b972b4a559602e1e4b7aa8d53a564d87c84a010000000000002251202874162b92b8d3be94843507d3a2c27b533e61ae775a177e7317e935be89f04f4a01000000000000225120acb9c6e99223b203a4af8b2a6ce39bb1e23c0a3123f5242f0e0b1777a53a36774a01000000000000225120ebdc247bd6c6454be70ebb16f54203e50549c5c9053350a0295696a517ceaad24a010000000000002251205b99180e687628d855fbf65bc9a78bea6ef1870465b8efdfd756fbdb9f0f34904a0100000000000022512035aeb2f8fdb9617f2b1c04c78d452f6fbf245cd77bea1a65cdd3b494d5cb594e4a010000000000002251204288d1d887e0fc2511fb6131269c0f607f3440a696eff4fbb47c04215f10e5d14a010000000000002251203409a0a1b4dac615bbb610e5f129a1a0529f577557033dad24e22900b6409baa4a01000000000000225120dad7948aeda4c13ff9ef090f9b4948b972b4a559602e1e4b7aa8d53a564d87c84a010000000000002251202874162b92b8d3be94843507d3a2c27b533e61ae775a177e7317e935be89f04f4a01000000000000225120acb9c6e99223b203a4af8b2a6ce39bb1e23c0a3123f5242f0e0b1777a53a36774a01000000000000225120ebdc247bd6c6454be70ebb16f54203e50549c5c9053350a0295696a517ceaad24a010000000000002251205b99180e687628d855fbf65bc9a78bea6ef1870465b8efdfd756fbdb9f0f34904a0100000000000022512035aeb2f8fdb9617f2b1c04c78d452f6fbf245cd77bea1a65cdd3b494d5cb594e4a010000000000002251202ab900cb03c69a017fd4b1c5c8a9b35edec599c7c614e284b4098e36d88561b84a010000000000002251205363b56d85e2af472bf6275c3f875026c4b6ed5c776dfbbeec0e75c61a4290674a01000000000000225120837089e6f39996d4b0a301838a1c146d40fb79ce32455b9390cc6ff407d0b4ad4a01000000000000225120a424305cb90773f9a9ee314d0a1172e76a5ccf20beec1b258d3965c1bdd5e25a4a01000000000000225120f91144fd8b1e43dd85684f694e797f967a9d8a5da4ede96b9c39eabc22acfac84a0100000000000022512022df0320bbaeac36f421ae05895a73e9212ac6b4c020a10c34423a2f4dd280dc4a010000000000002251208322f3cc434065f11f0f4c790f23dc103e0004c05230437973290092e7bfc89e034075397786df994c7357893590376bc7cab5aa41e780cb8614a7dd7cbd439ec830c6edebb31af447c2c4dafb2b0dfd56114d4020b797cc1247a2a658b7153d633d2220c46132cbb3ef14caeac8f724fea1449d802133495ef1675f210b0742f5ee8164ac61c12be4d02127fedf4c956f8e6d8248420b9af78746232315f72894f0b263c80e81071ef120de1128355b2ac51af4e44b327234379fadb0fafd5bb0ebf5ff6408a5078dd4bb8e3ae3fb38762d09622a24ff352f723c4584e8c76cfcf7ffcc462c7800000000";
        let block: Block =
            bitcoin::consensus::deserialize(&hex::decode(raw_block).unwrap()).unwrap();
        let claim_tx_result = get_claim_txn(&block, 2);
        dbg!(claim_tx_result);
    }
}
